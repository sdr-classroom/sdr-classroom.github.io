<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Labo 2 - Ordre total des messages</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #cccccc; background-color: #303030; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ffcfaf; } /* Alert */
    code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
    code span.at { } /* Attribute */
    code span.bn { color: #dca3a3; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #f0dfaf; } /* ControlFlow */
    code span.ch { color: #dca3a3; } /* Char */
    code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
    code span.co { color: #7f9f7f; } /* Comment */
    code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
    code span.do { color: #7f9f7f; } /* Documentation */
    code span.dt { color: #dfdfbf; } /* DataType */
    code span.dv { color: #dcdccc; } /* DecVal */
    code span.er { color: #c3bf9f; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #c0bed1; } /* Float */
    code span.fu { color: #efef8f; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
    code span.kw { color: #f0dfaf; } /* Keyword */
    code span.op { color: #f0efd0; } /* Operator */
    code span.ot { color: #efef8f; } /* Other */
    code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
    code span.sc { color: #dca3a3; } /* SpecialChar */
    code span.ss { color: #cc9393; } /* SpecialString */
    code span.st { color: #cc9393; } /* String */
    code span.va { } /* Variable */
    code span.vs { color: #cc9393; } /* VerbatimString */
    code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
  </style>
  <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/labos/style.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
    <main>
<header id="title-block-header">
    <nav>
        <a href="/labos/labos.html"><i class="fa fa-angle-left"></i> Back</a>
      </nav>
<h1 class="title">Labo 2 - Ordre total des messages</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#changelog" id="toc-changelog">Changelog</a></li>
<li><a href="#introduction" id="toc-introduction">Introduction</a></li>
<li><a href="#informations-générales"
id="toc-informations-générales">Informations Générales</a></li>
<li><a href="#liens-utiles" id="toc-liens-utiles">Liens utiles</a></li>
<li><a href="#ordre-global-des-messages"
id="toc-ordre-global-des-messages">Ordre global des messages</a></li>
<li><a href="#phase-1-conception" id="toc-phase-1-conception">Phase 1 :
Conception</a></li>
<li><a href="#phase-2-implémentation"
id="toc-phase-2-implémentation">Phase 2 : Implémentation</a>
<ul>
<li><a href="#rendu" id="toc-rendu">Rendu</a></li>
</ul></li>
</ul>
</nav>
<h2 id="changelog">Changelog</h2>
<table>
<colgroup>
<col style="width: 8%" />
<col style="width: 91%" />
</colgroup>
<thead>
<tr class="header">
<th>Date</th>
<th>Changement</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10.29</td>
<td><a href="#phase-2-implémentation">Lien et précisions sur phase
2.</a></td>
</tr>
</tbody>
</table>
<h2 id="introduction">Introduction</h2>
<p>Ce labo a pour objectif de compléter l’application ChatsApp pour
garantir un ordre total des messages.</p>
<p>Vous aurez accès, comme point de départ à l’implémentation, à la
solution au labo 1.</p>
<h2 id="informations-générales">Informations Générales</h2>
<ul>
<li><strong>Groupes</strong> : à réaliser par groupes de deux.</li>
<li><strong>Plagiat</strong> : en cas de copie manifeste, vous y serez
confrontés, vous obtiendrez la note de 1, et l’incident sera reporté au
responsable de la filière, avec un risque d’échec critique immédiat au
cours. Ne trichez pas. <span class="remark">(Notez que les IAs
génératives se trouvent aujourd’hui dans une zone qui est encore
juridiquement floue pour ce qui est du plagiat, mais des arguments se
valent à en considérer l’utilisation comme tel. Quoiqu’il en soit, nous
vous proposons une autre vision sur la question : votre ambition est
d’apprendre et d’acquérir des compétences, et votre utilisation
éventuelle de cet outil doit refléter cela. Tout comme StackOverflow
peut être autant un outil d’enrichissement qu’une banque de copy-paste,
faites un choix intentionnel et réfléchi, vos propres intérêts en tête,
de l’outil que vous ferez de l’IA générative)</span></li>
</ul>
<h2 id="liens-utiles">Liens utiles</h2>
<ul>
<li><a href="https://classroom.github.com/a/rK7JoECZ">Repo GitHub de la
phase 1</a></li>
<li><a href="https://classroom.github.com/a/vQc2DytO">Repo GitHub de la
phase 2</a></li>
<li><a href="/labos/labos.html#chronologie-de-chaque-labo">Protocole de
rendu des labos de SDR</a></li>
<li><a href="/labos/design-specs/1-tcp-rr.html">Document d’Architecture
Logicielle de la solution au labo 1</a></li>
</ul>
<h2 id="ordre-global-des-messages">Ordre global des messages</h2>
<p>Le but de ce labo est de compléter l’application distribuée ChatsApp
avec la garantie que l’ordre des messages est le même pour tous les
serveurs. Cela signifie que, pour tous deux messages <code>m1</code> et
<code>m2</code>, peu importe leur source, si un serveur <code>A</code>
affiche <code>m1</code> avant <code>m2</code>, alors tous les autres
serveurs afficheront <code>m1</code> avant <code>m2</code>.</p>
<h2 id="phase-1-conception">Phase 1 : Conception</h2>
<p>Vous trouverez, dans le repo <a
href="https://classroom.github.com/a/rK7JoECZ">GitHub Classroom</a> de
la phase 1, le document d’architecture logicielle à compléter avec votre
proposition de solution. Le format attendu est le même qu’au labo 1.
L’évaluation de ce document se basera sur les questions ci-dessous ; il
faudra (1) que votre document contienne les informations nécessaires
pour répondre à ces questions, et (2) que ces réponses forment une
solution correcte au problème posé.</p>
<ul>
<li>Quelle(s) abstraction(s) devront être créée(s) ?
<ul>
<li>Quelles sont leurs responsabilités (que font-elles, que
délèguent-elles, que savent-elles, que ne savent-elles pas) ?</li>
<li>Quel est leur API exact (constructeur, méthodes) ? N’hésitez pas à
donner des exemples d’utilisation de vos abstractions.</li>
</ul></li>
<li>Quelles sont les goroutines nécessaires ?
<ul>
<li>De quel état sont-elles responsables ?</li>
<li>Quand et par qui sont-elles créées ?</li>
</ul></li>
<li>Pour tout channel nécessaire à la communication entre goroutines,
<ul>
<li>Où sont-ils stockés ?</li>
<li>Quelle(s) goroutine(s) y écrivent, et lesquelles y lisent ?</li>
</ul></li>
<li>Quels changements à <code>server.go</code> permettront de garantir
l’ordre total des messages ?</li>
</ul>
<p><span class="remark">Pour les groupes de trois : comment
garantissez-vous une complexité asymptotique de calcul de <span
class="math inline"><em>o</em>(<em>n</em>)</span> pour chaque message
envoyé, où <span class="math inline"><em>n</em></span> est le nombre de
processus et <span class="math inline"><em>o</em>(⋅)</span> est la <a
href="https://en.wikipedia.org/wiki/Big_O_notation#Little-o_notation">notation
petit-o</a> ? </span></p>
<h2 id="phase-2-implémentation">Phase 2 : Implémentation</h2>
<p>Une fois la phase 1 terminée, vous trouverez <a
href="https://classroom.github.com/a/vQc2DytO">ici</a> le repo sur
lequel vous devrez implémenter la solution. Celui-ci contiendra la
solution du labo 1 ainsi qu’un point de départ pour la partie 2. Ce
point de départ imposera des abstractions et APIs, mais vous laissera
libre d’implémenter le fonctionnement interne que vous aurez
proposé.</p>
<p>Le code fourni introduit également un <code>Dispatcher</code>,
responsable de faciliter les échanges avec le réseau : (1) en gérant la
traduction entre <code>[]byte</code> et <code>Message</code>, et (2) en
répartissant les messages venant du réseau en fonction du type de
message reçu. L’extrait suivant illustre l’utilisation de ce
dispatcher.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// dispatcher étant une instance de Dispatcher.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Enregistrement d&#39;un handler pour les messages de type ChatMessage</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>dispatcher<span class="op">.</span>Register<span class="op">(</span>ChatMessage<span class="op">{},</span> <span class="kw">func</span><span class="op">(</span>m Message<span class="op">,</span> source Address<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    chatMessage <span class="op">:=</span> m<span class="op">.(</span>ChatMessage<span class="op">)</span> <span class="co">// Conversion on ChatMessage</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    fmt<span class="op">.</span>Printf<span class="op">(</span><span class="st">&quot;Message %v reçu de la part de %v.</span><span class="ch">\n</span><span class="st">&quot;</span><span class="op">,</span> chatMessage<span class="op">,</span> source<span class="op">)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="op">})</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Enregistrement d&#39;un handler pour les messages de type Mutex</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>dispatcher<span class="op">.</span>Register<span class="op">(</span>mutex<span class="op">.</span>Message<span class="op">{},</span> <span class="kw">func</span><span class="op">(</span>m Message<span class="op">,</span> source Address<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    mutex <span class="op">:=</span> m<span class="op">.(</span>mutex<span class="op">.</span>Message<span class="op">)</span> <span class="co">// Conversion en mutex.Message</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    fmt<span class="op">.</span>Printf<span class="op">(</span><span class="st">&quot;Message de type mutex %v reçu de la part de %v.</span><span class="ch">\n</span><span class="st">&quot;</span><span class="op">,</span> mutex<span class="op">,</span> source<span class="op">)</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="op">})</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Envoi de messages</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>chatMsg <span class="op">:=</span> ChatMessage<span class="op">{</span>Content<span class="op">:</span> <span class="st">&quot;Hello, world!&quot;</span><span class="op">}</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>dispatcher<span class="op">.</span>Send<span class="op">(</span>chatMsg<span class="op">,</span> dstAddr<span class="op">)</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>mtxMsg <span class="op">=</span> mutex<span class="op">.</span>Message<span class="op">{</span>Type<span class="op">:</span> mutex<span class="op">.</span>Request<span class="op">,</span> TS<span class="op">:</span> ts<span class="op">}</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>dispatcher<span class="op">.</span>Send<span class="op">(</span>mtxMsg<span class="op">,</span> dstAddr<span class="op">)</span></span></code></pre></div>
<p>Le serveur initialise et met en place un dispatcher auprès duquel
vous ne devriez avoir qu’à enregistrer vos nouveaux types de
messages.</p>
<p>Notez également que :</p>
<ul>
<li>Il vous faudra implémenter une Mutex de Lamport.</li>
<li>Les tests fournis supposent que cette Mutex ne s’envoie jamais de
message à elle-même à travers le réseau.</li>
<li>Vous ne devez en aucun cas utiliser les abstractions fournies par le
package <code>sync</code> de Go. Toute gestion de la concurrence doit
être gérée par des goroutines et des channels.</li>
<li>Vous êtes libres d’ajouter des tests, mais ne devez pas modifier
ceux fournis.</li>
</ul>
<h3 id="rendu">Rendu</h3>
<p>Votre rendu doit être intégralement compris dans le commit le plus
récent avant la deadline. Cela inclue non seulement le code, mais
également le document d’architecture logicielle décrivant votre travail.
Celui-ci n’aura besoin de couvrir que vos ajouts ; nul besoin de décrire
le code fourni. Il doit satisfaire les mêmes exigences que celles
exprimées pour le rendu de la phase 1.</p>
</main>
</body>
</html>
