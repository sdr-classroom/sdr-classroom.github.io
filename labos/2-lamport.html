<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Labo 2 - Gestionnaire de dettes distribué</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #cccccc; background-color: #303030; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ffcfaf; } /* Alert */
    code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
    code span.at { } /* Attribute */
    code span.bn { color: #dca3a3; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #f0dfaf; } /* ControlFlow */
    code span.ch { color: #dca3a3; } /* Char */
    code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
    code span.co { color: #7f9f7f; } /* Comment */
    code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
    code span.do { color: #7f9f7f; } /* Documentation */
    code span.dt { color: #dfdfbf; } /* DataType */
    code span.dv { color: #dcdccc; } /* DecVal */
    code span.er { color: #c3bf9f; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #c0bed1; } /* Float */
    code span.fu { color: #efef8f; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
    code span.kw { color: #f0dfaf; } /* Keyword */
    code span.op { color: #f0efd0; } /* Operator */
    code span.ot { color: #efef8f; } /* Other */
    code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
    code span.sc { color: #dca3a3; } /* SpecialChar */
    code span.ss { color: #cc9393; } /* SpecialString */
    code span.st { color: #cc9393; } /* String */
    code span.va { } /* Variable */
    code span.vs { color: #cc9393; } /* VerbatimString */
    code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
  </style>
  <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/labos/style.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
    <main>
<header id="title-block-header">
    <nav>
        <a href="/"><i class="fa fa-angle-left"></i> Back</a>
      </nav>
<h1 class="title">Labo 2 - Gestionnaire de dettes distribué</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#changelog" id="toc-changelog">Changelog</a></li>
<li><a href="#informations-générales"
id="toc-informations-générales">Informations Générales</a></li>
<li><a href="#introduction" id="toc-introduction">Introduction</a></li>
<li><a href="#suppositions" id="toc-suppositions">Suppositions</a></li>
<li><a href="#serveurs" id="toc-serveurs">Serveurs</a>
<ul>
<li><a href="#fichier-de-configuration"
id="toc-fichier-de-configuration">Fichier de configuration</a></li>
<li><a href="#modifications-et-synchronisation-des-copies-locales"
id="toc-modifications-et-synchronisation-des-copies-locales">Modifications
et synchronisation des copies locales</a></li>
</ul></li>
<li><a href="#clients" id="toc-clients">Clients</a>
<ul>
<li><a href="#clear-debts" id="toc-clear-debts">Clear debts</a></li>
<li><a href="#autres-changements" id="toc-autres-changements">Autres
changements</a></li>
</ul></li>
<li><a href="#tests" id="toc-tests">Tests</a></li>
<li><a href="#rendu" id="toc-rendu">Rendu</a></li>
<li><a href="#contraintes-supplémentaires"
id="toc-contraintes-supplémentaires">Contraintes
supplémentaires</a></li>
</ul>
</nav>
<h2 id="changelog">Changelog</h2>
<table>
<thead>
<tr class="header">
<th>Date</th>
<th>Changement</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="informations-générales">Informations Générales</h2>
<ul>
<li><strong>Date du rendu</strong> : Lundi 13 Novembre, 13:15 CEST.</li>
<li><strong>Groupes</strong> : à réaliser seul ou à deux. Vous pouvez
réutiliser les groupes du précédent labo.</li>
<li><strong>Plagiat</strong> : en cas de copie manifeste, vous y serez
confrontés, vous obtiendrez la note de 1, et l’incident sera reporté au
responsable de la filière, avec un risque d’échec critique immédiat au
cours. Ne trichez pas. <em>(Notez que les IAs génératives se trouvent
aujourd’hui dans une zone qui est encore juridiquement floue pour ce qui
est du plagiat, mais des arguments se valent à en considérer
l’utilisation comme tel. Quoiqu’il en soit, nous vous proposons une
autre vision sur la question : votre ambition est d’apprendre et
d’acquérir des compétences, et votre utilisation éventuelle de cet outil
doit refléter ceci. Tout comme Stackoverflow peut être à la fois un
outil d’enrichissement et une banque de copy-paste, faites un choix
intentionnel et réfléchi, vos propres intérêts en tête, de l’outil que
vous ferez de l’IA générative)</em></li>
</ul>
<h1 id="introduction">Introduction</h1>
<p>Ce labo a pour but de modifier le précédent pour le rendre non plus
centralisé mais distribué. La forme de distribution que nous avons
choisie est celle dans laquelle chaque serveur du système aura une
réplique locale de l’état actuel des dettes entre les membres du groupe.
Il faudra donc s’assurer que ces copies locales sont synchronisés en
tout temps.</p>
<p>Vous devez repartir de votre code du labo 1. Si vous avez formé une
nouvelle team, utilisez le code de l’un ou l’une des deux membres de la
nouvelle team. Si la team à laquelle appartenait ce code contenait deux
membres, et que l’autre membre réutilise aussi ce même code dans sa
nouvelle équipe <strong>ceci doit être précisé explicitement dans votre
README, afin que cela n’apparaisse pas comme du plagiat.</strong></p>
<p>Puisque ce labo construit sur le premier, toutes les indications du
premier énoncé qui ne sont pas rendues obsolètes par celui-ci restent
valables et doivent donc continuer d’être vérifiées par votre solution à
ce labo-ci.</p>
<h1 id="suppositions">Suppositions</h1>
<p>Dans ce labo, nous supposerons qu’aucun serveur ne peut tomber en
panne fatale. Cela signifie que vous ne devez pas implémenter de gestion
de crash ou de disparition d’un serveur, ou encore de serveur dont le
comportement est reset (ce qui se produirait si un serveur venait à
crash puis serait rebooté).</p>
<p>Votre solution devra, cependant, savoir gérer le cas où un serveur
devient soudainement lent, ou est mis en pause pendant une durée
arbitraire. Ceci ne devrait, cependant, pas nécessiter de considération
particulière dans votre code.</p>
<h1 id="serveurs">Serveurs</h1>
<p>Plusieurs serveurs peuvent maintenant fonctionner ensemble pour
former le système de gestion des dettes. Chaque serveur a une copie
locale du graphe de dettes, et ils doivent s’assurer de toujours
partager la même vue sur celui-ci. Les principales modifications et
ajouts à faire dans ce but sont décrits ici.</p>
<h2 id="fichier-de-configuration">Fichier de configuration</h2>
<p>Le fichier de configuration est modifié pour inclure la liste des
adresses des serveurs formant le système, sous un champ “servers”. Voici
un exemple de fichier de configuration avec cette modification.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;debug&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;port&quot;</span><span class="fu">:</span> <span class="dv">3333</span><span class="fu">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;users&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;username&quot;</span><span class="fu">:</span> <span class="st">&quot;jessie&quot;</span><span class="fu">,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;debts&quot;</span><span class="fu">:</span> <span class="ot">[]</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;username&quot;</span><span class="fu">:</span> <span class="st">&quot;ollie&quot;</span><span class="fu">,</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;debts&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>                <span class="fu">{</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;username&quot;</span><span class="fu">:</span> <span class="st">&quot;jessie&quot;</span><span class="fu">,</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;amount&quot;</span><span class="fu">:</span> <span class="dv">4</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>                <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>            <span class="ot">]</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;servers&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;127.0.0.1:3333&quot;</span><span class="ot">,</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;127.0.0.1:3334&quot;</span><span class="ot">,</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;127.0.0.1:3335&quot;</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Le serveur peut, lorsqu’il parse ce fichier, supposer cette liste
exhaustive ; nous ne testerons pas le cas d’un fichier de configuration
dont la liste de serveurs ne reflette pas le système dans son
entièreté.</p>
<h2
id="modifications-et-synchronisation-des-copies-locales">Modifications
et synchronisation des copies locales</h2>
<p>La synchronisation entre serveurs des copies locales se fera à l’aide
de l’algorithme d’exclusion mutuelle de Lamport (et non l’une de ses
optimisations que nous voyons dans les cours suivants).</p>
<p>Lorsqu’un serveur souhaite effectuer une modification à sa copie du
graphe, il doit s’assurer que cette modification est faite sur tous les
autres serveurs du système également. Il vous faudra donc mettre en
place un protocole de communication permettant cet échange, et
permettant au serveur à l’origine de la modification de savoir quand
celle-ci a été effectuée partout.</p>
<p>Afin d’assurer que deux serveurs ne peuvent pas déclencher une
modification du graphe au même moment et causer une potentielle
desynchronisation des copies, toute modification doit être faite dans
une section critique, au sens de l’exclusion mutuelle telle que vue en
cours. La section critique doit donc être entrée par le serveur à
l’origine de la requête avant toute modification à sa copie locale, et
doit être quittée uniquement lorsque toutes les copies locales ont été
modifiées correctement.</p>
<p>Nous vous encourageons à très clairement séparer les différents
modules du serveur, notamment l’abstraction mutex et la partie
applicative, ou encore la couche de gestion réseau. Chacun de ces
modules a ses responsabilités et devrait pouvoir les implémenter de la
manière la plus indépendante possible des autres. Réfléchissez à ces
responsabilités et aux APIs nécessaires à chaque module avant de vous
lancer dans l’implémentation.</p>
<h1 id="clients">Clients</h1>
<h2 id="clear-debts">Clear debts</h2>
<p>Nous vous demandons d’ajouter une nouvelle commande permettant de
rembourser toutes ses dettes. Cette commande ne prend aucun argument, et
efface toutes les dettes de l’utilisatrice ou l’utilisateur actuel de ce
client. Elle retourne <code>Success</code> si tout s’est bien passé, et
un message d’erreur clair dans le cas contraire. Quelques changements
seront bien sûr nécessaires dans le serveur pour permettre cette
nouvelle fonctionnalité.</p>
<p>Voici un exemple d’utilisation de cette nouvelle commande</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./client jessie localhost:3333</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> pay <span class="ex">32</span> for blake</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Success</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> get <span class="ex">debts</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ex">blake:</span> 32</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="ex">32</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> clear</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Success</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> get <span class="ex">debts</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> exit</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span></span></code></pre></div>
<h2 id="autres-changements">Autres changements</h2>
<p>Aucune autre modification n’est nécessaire sur le client. Il continue
de prendre en argument l’adresse IP du serveur sur lequel il doit se
connecter, et continue de communiquer avec lui comme si ce serveur était
l’unique responsable du système. Le but est de rendre l’aspect distribué
entièrement invisible à l’utilisateur ou l’utilisatrice.</p>
<h1 id="tests">Tests</h1>
<p>Comme pour le labo précédent, nous vous demandons d’implémenter des
tests pour ces nouvelles fonctionnalités et pour vérifier le bon
fonctionnement de l’algorithme de Lamport. Nous vous recommandons par
ailleurs de garder vos tests actuels et de les compléter si
nécessaire.</p>
<h1 id="rendu">Rendu</h1>
<p>Les éléments à rendre sont les mêmes que pour le labo précédent,
notamment les fichiers executables.</p>
<p>Aussi, nous vous demandons à nouveau de décrire l’architecture
logicielle de votre solution dans le README de votre repo. Vous devez
décrire les différents modules et principales goroutines, leurs
responsabilités et leurs moyens d’interaction avec le reste du système.
Toute décision non-triviale doit être justifiée, mais inutile de rentrer
dans chaque détail, le but étant de décrire la “big picture” de votre
solution. Ceci nous servira à mieux appréhender votre code lorsque nous
en évaluerons la qualité manuellement, et à juger de la pertinence de
vos choix d’architecture et d’implémentation. Voyez aussi cela comme un
exercice simplifié d’écriture de Design Specification.</p>
<h1 id="contraintes-supplémentaires">Contraintes supplémentaires</h1>
<p>Les contraintes du labo précédent s’appliquent également à
celui-ci.</p>
</main>
</body>
</html>
